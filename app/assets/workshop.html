<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Workshop</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Load Puter SDK with error handling
        (function() {
            const script = document.createElement('script');
            script.src = 'https://js.puter.com/v2/';
            script.onload = function() {
                console.log('Puter SDK loaded successfully');
            };
            script.onerror = function() {
                console.error('Failed to load Puter SDK');
                // Define a mock puter object to prevent errors
                window.puter = {
                    auth: {
                        signIn: function() { return Promise.reject(new Error('Puter SDK not loaded')); },
                        signOut: function() { console.log('Puter sign out called but SDK not loaded'); }
                    }
                };
            };
            document.head.appendChild(script);
        })();
    </script>
    <style>
        :root {
            --primary-color: #ff6b39;
            --primary-hover: #ff8c5a;
            --primary-light: rgba(255, 107, 57, 0.1);
            --background-dark: #1b1a1a;
            --background-darker: #161515;
            --surface-color: #262525;
            --surface-hover: #2d2c2c;
            --border-color: #3a3939;
            --border-light: #4a4949;
            --text-primary: #e0e0e0;
            --text-secondary: #c0bebe;
            --text-muted: #888;
            --text-accent: #ff8c5a;
            --success-color: #4ade80;
            --warning-color: #fbbf24;
            --error-color: #ef4444;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.2);
            --shadow-xl: 0 12px 32px rgba(0, 0, 0, 0.25);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html,
        body {
            height: 100%;
            background: var(--background-dark);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-primary);
        }

        body {
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 32px;
            background: linear-gradient(135deg, #1b1a1a 0%, #171616 50%, #1a1919 100%);
            min-height: 100vh;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 32px;
            background: linear-gradient(135deg, var(--surface-color) 0%, #242323 100%);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 24px;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            background: linear-gradient(45deg, var(--primary-color), var(--primary-hover), #ffb380);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.025em;
        }

        .search-container {
            position: relative;
            width: 60%;
            max-width: 600px;
            display: flex;
            align-items: center;
        }

        #searchInput {
            padding: 16px 24px 16px 56px;
            font-size: 1rem;
            border-radius: var(--radius-xl);
            border: 1px solid var(--border-color);
            background: var(--background-darker);
            color: var(--text-primary);
            outline: none;
            width: 100%;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: var(--transition);
            font-weight: 500;
        }

        #searchInput::placeholder {
            color: var(--text-muted);
        }

        #searchInput:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 107, 57, 0.2), inset 0 2px 8px rgba(0, 0, 0, 0.2);
            background: var(--surface-color);
        }

        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 1.1rem;
            z-index: 1;
        }

        .hero-showcase {
            display: flex;
            gap: 32px;
            background: linear-gradient(135deg, var(--surface-color) 0%, #252424 100%);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            padding: 40px;
            box-shadow: var(--shadow-lg);
            margin-bottom: 32px;
        }

        .hero-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 24px;
        }

        .hero-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--text-primary);
            margin: 0;
            line-height: 1.2;
            background: linear-gradient(45deg, var(--primary-color), var(--primary-hover), #ffb380);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin: 0;
            line-height: 1.6;
            max-width: 90%;
        }

        .hero-stats {
            display: flex;
            gap: 40px;
            margin: 16px 0;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            flex: 1;
            max-width: 120px;
            transition: transform 0.3s ease, opacity 0.3s ease;
            opacity: 0;
            transform: translateY(20px);
        }

        .stat-item.animate-in {
            opacity: 1;
            transform: translateY(0);
        }

        .stat-item:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 2rem;
            color: var(--primary-color);
            background: rgba(255, 107, 57, 0.1);
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 1px solid rgba(255, 107, 57, 0.2);
            transition: all 0.3s ease;
        }

        .stat-item:hover .stat-icon {
            transform: scale(1.1);
            background: rgba(255, 107, 57, 0.2);
            box-shadow: 0 0 15px rgba(255, 107, 57, 0.3);
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .stat-item:hover .stat-number {
            color: var(--primary-color);
            text-shadow: 0 0 10px rgba(255, 107, 57, 0.5);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .hero-buttons {
            display: flex;
            gap: 16px;
            margin-top: 16px;
        }

        .hero-btn {
            padding: 14px 28px;
            border-radius: var(--radius-lg);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
            border: none;
        }

        .hero-btn.primary {
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--primary-hover) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(255, 107, 57, 0.3);
        }

        .hero-btn.primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(255, 107, 57, 0.4);
        }

        .hero-btn.secondary {
            background: linear-gradient(145deg, #3a3939, #2a2929);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .hero-btn.secondary:hover {
            background: linear-gradient(145deg, #4a4949, #3a3939);
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .hero-featured {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .featured-carousel {
            position: relative;
            height: 300px;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        .carousel-item {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .carousel-item.active {
            opacity: 1;
        }

        .featured-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .featured-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2a2929, #1a1919);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .featured-icon {
            font-size: 5rem;
            color: var(--primary-color);
            opacity: 0.7;
        }

        .featured-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
            padding: 24px;
            color: white;
        }

        .featured-overlay h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0 0 8px 0;
            color: white;
        }

        .featured-overlay p {
            font-size: 1rem;
            margin: 0 0 16px 0;
            color: rgba(255, 255, 255, 0.9);
        }

        .featured-tag {
            background: rgba(255, 107, 57, 0.9);
            color: white;
            padding: 6px 12px;
            border-radius: var(--radius-md);
            font-size: 0.8rem;
            font-weight: 600;
        }

        .carousel-nav {
            display: flex;
            justify-content: center;
            gap: 12px;
        }

        .nav-btn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: none;
            background: var(--border-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .nav-btn.active,
        .nav-btn:hover {
            background: var(--primary-color);
            transform: scale(1.2);
        }

        .navigation-tabs {
            display: flex;
            gap: 12px;
            padding: 0 24px;
        }

        .tab-btn {
            background: linear-gradient(145deg, var(--surface-color), #212020);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 14px 24px;
            font-size: 1rem;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
            font-weight: 600;
        }

        .tab-btn:hover {
            background: linear-gradient(145deg, var(--surface-hover), #252424);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            color: var(--text-primary);
        }

        .tab-btn.active {
            background: linear-gradient(90deg, var(--primary-color), var(--primary-hover));
            color: white;
            border-color: var(--primary-hover);
            box-shadow: var(--shadow-md);
        }

        .content-sections {
            display: flex;
            flex-direction: column;
            gap: 48px;
        }

        .section {
            background: linear-gradient(145deg, var(--surface-color), #212020);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            padding: 32px;
            box-shadow: var(--shadow-lg);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 0;
        }

        .section-title i {
            color: var(--primary-color);
        }

        .section-count {
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-muted);
            background: var(--background-darker);
            padding: 4px 12px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
        }

        .section-controls {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .sort-select {
            padding: 10px 16px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
            background: var(--background-darker);
            color: var(--text-primary);
            font-size: 0.95rem;
            outline: none;
            cursor: pointer;
            transition: var(--transition);
        }

        .sort-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(255, 107, 57, 0.2);
        }

        .item-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 28px;
            padding: 10px 0;
        }

        @media (max-width: 968px) {
            .hero-showcase {
                flex-direction: column;
            }

            .hero-content {
                text-align: center;
                align-items: center;
            }

            .hero-subtitle {
                max-width: 100%;
            }

            .hero-stats {
                justify-content: center;
            }

            .hero-buttons {
                justify-content: center;
            }

            .navigation-tabs {
                flex-wrap: wrap;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }
        }

        @media (max-width: 640px) {
            .section-controls {
                flex-direction: column;
                align-items: flex-start;
                width: 100%;
            }

            .sort-select {
                width: 100%;
            }

            .hero-stats {
                flex-direction: column;
                gap: 20px;
            }

            .hero-buttons {
                flex-direction: column;
                width: 100%;
            }

            .hero-btn {
                width: 100%;
                justify-content: center;
            }
        }

        .item-card {
            background: linear-gradient(145deg, var(--surface-color), #212020);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            overflow: hidden;
            position: relative;
            height: 100%;
        }

        .item-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: var(--shadow-xl);
            border-color: var(--border-light);
            background: linear-gradient(145deg, var(--surface-hover), #252424);
        }

        .image-container {
            position: relative;
            overflow: hidden;
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            height: 200px;
        }

        .pin-icon {
            position: absolute;
            top: 16px;
            right: 16px;
            z-index: 10;
            background: rgba(255, 107, 57, 0.9);
            color: white;
            padding: 8px;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-md);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .item-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .item-card:hover .item-image {
            transform: scale(1.05);
        }

        .item-content {
            padding: 24px;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            gap: 16px;
        }

        .item-title {
            margin: 0;
            font-size: 1.5rem;
            color: var(--text-accent);
            font-weight: 700;
            line-height: 1.3;
            letter-spacing: -0.025em;
        }

        .item-author {
            font-size: 0.9rem;
            color: var(--text-muted);
            font-style: italic;
            margin-top: -12px;
            font-weight: 500;
        }

        .item-description-wrapper {
            position: relative;
            flex-grow: 1;
        }

        .item-description {
            font-size: 1rem;
            color: var(--text-secondary);
            line-height: 1.65;
            font-weight: 400;
            margin: 0;
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 3;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 4.95em;
        }

        .item-description.expanded {
            -webkit-line-clamp: unset;
            max-height: 1000px;
            transition: max-height 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .read-more-btn {
            display: none;
            background: none;
            border: none;
            color: var(--primary-color);
            font-weight: 600;
            cursor: pointer;
            padding: 0;
            margin-top: 12px;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .read-more-btn:hover {
            color: var(--primary-hover);
            text-decoration: underline;
        }

        .item-footer {
            margin-top: auto;
            padding: 24px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .download-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            text-align: center;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);
            color: #fff;
            padding: 12px 24px;
            border-radius: var(--radius-lg);
            text-decoration: none;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            letter-spacing: 0.025em;
            height: 50px;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            background: linear-gradient(135deg, var(--primary-hover) 0%, #ff9d6b 100%);
        }

        .download-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .grid-message {
            grid-column: 1 / -1;
            text-align: center;
            padding: 60px 40px;
            color: var(--text-secondary);
            font-size: 1.1rem;
            background: var(--surface-color);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-md);
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .grid-message i {
            font-size: 4rem;
            margin-bottom: 24px;
            color: var(--primary-color);
            opacity: 0.8;
        }

        .grid-message h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .grid-message p {
            font-size: 1rem;
            color: var(--text-secondary);
            margin: 0;
            line-height: 1.6;
        }

        .loading-spinner {
            width: 56px;
            height: 56px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 24px auto;
            box-shadow: var(--shadow-sm);
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .button-group {
            display: flex;
            gap: 10px;
            width: 100%;
        }

        .share-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #6c757d, #495057);
            color: #fff;
            padding: 22px;
            border-radius: var(--radius-lg);
            text-decoration: none;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            letter-spacing: 0.025em;
            cursor: pointer;
            flex: 1;
            min-width: 0;
            height: 50px;
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            background: linear-gradient(135deg, #7a8288, #5a6268);
        }

        .share-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .share-btn i {
            margin: 0;
            font-size: 1.2rem;
        }

        .share-popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
            z-index: 1000;
        }

        .share-popup-content {
            background: linear-gradient(145deg, var(--surface-color), #252424);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow-xl);
            position: relative;
        }

        .share-popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .share-popup-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .close-share-popup {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }

        .close-share-popup:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .share-pack-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: var(--radius-lg);
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .share-pack-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-accent);
            margin: 0 0 8px 0;
        }

        .share-pack-author {
            font-size: 1rem;
            color: var(--text-muted);
            margin: 0 0 15px 0;
        }

        .share-pack-description {
            font-size: 1rem;
            color: var(--text-secondary);
            line-height: 1.6;
            margin: 0 0 25px 0;
        }

        .share-url-container {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        .share-url-input {
            flex: 1;
            padding: 12px 16px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
            background: var(--background-darker);
            color: var(--text-primary);
            font-size: 0.9rem;
            outline: none;
        }

        .share-url-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(255, 107, 57, 0.2);
        }

        .copy-share-url-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
            color: white;
            border: none;
            border-radius: var(--radius-md);
            padding: 0 20px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .copy-share-url-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .share-download-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            text-align: center;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);
            color: #fff;
            padding: 14px 24px;
            border-radius: var(--radius-lg);
            text-decoration: none;
            font-weight: 700;
            font-size: 1rem;
            transition: var(--transition);
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255, 255, 255, 0.1);
            letter-spacing: 0.025em;
        }

        .share-download-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .auth-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .auth-btn {
            background: linear-gradient(90deg, #3a3939 0%, #2a2929 100%);
            border: 1px solid #4a4949;
            border-radius: 24px;
            padding: 12px 24px;
            font-size: 1rem;
            color: #d8d8d8;
            cursor: pointer;
            white-space: nowrap;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            background: linear-gradient(90deg, #4a4949 0%, #3a4949 100%);
        }

        .create-btn {
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--primary-hover) 100%);
            border: 1px solid var(--primary-hover);
            border-radius: 24px;
            padding: 12px 24px;
            font-size: 1rem;
            color: #fff;
            cursor: pointer;
            white-space: nowrap;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .create-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(145deg, var(--surface-color), #252424);
            border: 1px solid var(--border-color);
            border-radius: 24px;
            padding: 8px 16px;
        }

        #usernameDisplay {
            color: var(--text-accent);
            font-weight: 600;
        }

        .sign-out-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .sign-out-btn:hover {
            color: var(--primary-color);
            background: rgba(255, 107, 57, 0.1);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(145deg, var(--surface-color), #252424);
            margin: 5% auto;
            padding: 0;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            width: 90%;
            max-width: 1200px;
            max-height: 85vh;
            box-shadow: var(--shadow-xl);
            animation: modalopen 0.3s ease;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        @keyframes modalopen {
            from {
                opacity: 0;
                transform: translateY(-60px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }

        .modal-header h2 {
            margin: 0;
            color: var(--text-accent);
            font-size: 1.8rem;
            display: none;
        }

        .close {
            color: var(--text-muted);
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }

        .close:hover {
            color: var(--primary-color);
        }

        .modal-body {
            padding: 24px;
            max-height: calc(85vh - 120px);
            overflow-y: auto;
            background: var(--background-darker);
            display: flex;
            flex-direction: column;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-accent);
            font-size: 1.1rem;
        }

        .form-group label i {
            margin-right: 8px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 1rem;
            background: var(--background-darker);
            color: var(--text-primary);
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 107, 57, 0.3);
            background: var(--surface-color);
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: var(--text-muted);
        }

        .form-hint {
            margin-top: 8px;
            font-size: 0.85rem;
            color: var(--text-muted);
            font-style: italic;
        }

        .form-actions {
            display: flex;
            gap: 16px;
            margin-top: 24px;
        }

        #upload-form {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 1.5rem;
        }

        .form-col {
            flex: 1;
        }

        .form-columns {
            display: flex;
            gap: 30px;
            margin-bottom: 20px;
            align-items: stretch;
        }

        .form-column {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .form-column.left {
            flex: 1;
            padding-right: 20px;
            border-right: 1px solid var(--border-color);
        }

        .form-column.right {
            flex: 2;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            padding-bottom: 20px;
        }

        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .form-columns {
                flex-direction: column;
                gap: 20px;
            }

            .form-column.right {
                min-width: auto;
            }

            .form-column.left {
                padding-right: 0;
                border-right: none;
            }
        }

        .cancel-btn {
            background: linear-gradient(145deg, #3a3939, #2a2929);
            border: 1px solid #4a4949;
            border-radius: var(--radius-md);
            padding: 12px 24px;
            font-size: 1rem;
            color: #ccc;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            flex: 1;
            white-space: nowrap;
        }

        .cancel-btn:hover {
            background: linear-gradient(145deg, #4a4949, #3a3939);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .submit-btn {
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--primary-hover) 100%);
            border: 1px solid var(--primary-hover);
            border-radius: var(--radius-md);
            padding: 12px 24px;
            font-size: 1rem;
            color: #fff;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            flex: 2;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .submit-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .icon-selector-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .selected-icon-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100px;
            border: 2px dashed var(--border-color);
            border-radius: var(--radius-md);
            background: var(--background-darker);
            cursor: pointer;
            transition: all 0.3s;
        }

        .selected-icon-placeholder:hover {
            border-color: var(--primary-color);
            background: var(--surface-color);
        }

        .selected-icon-placeholder i {
            font-size: 3rem;
            color: var(--text-accent);
        }

        .icon-selector-btn {
            background: linear-gradient(90deg, #3a3939 0%, #2a2929 100%);
            border: 1px solid #4a4949;
            border-radius: var(--radius-md);
            padding: 12px 24px;
            font-size: 1rem;
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .icon-selector-btn:hover {
            background: linear-gradient(90deg, #4a4949 0%, #3a3939 100%);
            transform: translateY(-2px);
        }

        .icon-selector-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .icon-selector-content {
            background: linear-gradient(145deg, var(--surface-color), #252424);
            margin: 5% auto;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: var(--shadow-xl);
            animation: modalopen 0.3s ease;
        }

        .icon-selector-content .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .icon-selector-content .modal-header h2 {
            margin: 0;
            color: var(--text-accent);
            font-size: 1.8rem;
        }

        .close-icon-selector {
            color: var(--text-muted);
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }

        .close-icon-selector:hover {
            color: var(--primary-color);
        }

        .icon-selector-content .modal-body {
            padding: 24px;
            max-height: calc(80vh - 120px);
            overflow-y: auto;
        }

        .icon-search {
            margin-bottom: 20px;
        }

        .icon-search input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 1rem;
            background: var(--background-darker);
            color: var(--text-primary);
            transition: all 0.3s;
        }

        .icon-search input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 107, 57, 0.3);
            background: var(--surface-color);
        }

        .icon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 16px;
        }

        .icon-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--background-darker);
            cursor: pointer;
            transition: all 0.3s;
        }

        .icon-item:hover {
            border-color: var(--primary-color);
            background: var(--surface-color);
            transform: translateY(-3px);
        }

        .icon-item.selected {
            border-color: var(--primary-color);
            background: rgba(255, 107, 57, 0.2);
            box-shadow: 0 0 0 2px rgba(255, 107, 57, 0.5);
        }

        .icon-item i {
            font-size: 2rem;
            margin-bottom: 8px;
            color: var(--text-accent);
        }

        .icon-item .icon-name {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-align: center;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        #scriptInputsContainer {
            flex: 1;
            overflow-y: auto;
            max-height: 400px;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--background-darker);
        }

        .form-column.right h3 {
            color: var(--text-accent);
            margin-bottom: 15px;
            font-weight: 600;
        }

        .details-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: 100%;
        }

        .details-main {
            display: flex;
            gap: 20px;
            height: 100%;
        }

        .details-icon {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 300px;
            background: var(--background-darker);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
        }

        .details-script {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .details-script pre {
            background: var(--background-darker);
            padding: 16px;
            border-radius: var(--radius-md);
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            flex-grow: 1;
            margin: 0;
            border: 1px solid var(--border-color);
            line-height: 1.4;
        }

        .details-meta {
            display: flex;
            justify-content: space-between;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .no-results {
            grid-column: 1 / -1;
            text-align: center;
            padding: 60px 40px;
            color: var(--text-secondary);
            font-size: 1.1rem;
            background: var(--surface-color);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-md);
        }

        .no-results i {
            font-size: 4rem;
            margin-bottom: 24px;
            color: var(--primary-color);
            opacity: 0.8;
        }

        .no-results h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .no-results p {
            font-size: 1rem;
            color: var(--text-secondary);
            margin: 0;
            line-height: 1.6;
        }

        .no-results button {
            margin-top: 20px;
            padding: 8px 16px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
        }

        .no-results button:hover {
            background: var(--primary-hover);
        }

        @media (max-width: 768px) {
            body {
                padding: 15px;
            }

            .header {
                flex-direction: column;
                gap: 16px;
            }

            .search-container {
                width: 100%;
            }

            .item-grid {
                grid-template-columns: 1fr;
            }

            .details-main {
                flex-direction: column;
            }

            .details-icon {
                height: 200px;
            }

            .details-script pre {
                max-height: 200px;
            }

            .form-actions {
                flex-direction: column;
            }

            .cancel-btn,
            .submit-btn {
                width: 100%;
                flex: none;
            }

            .auth-section {
                width: 100%;
                justify-content: center;
            }

            .modal-content {
                width: 95%;
                max-height: 95vh;
                margin: 2.5% auto;
            }

            .modal-body {
                max-height: calc(95vh - 120px);
                padding: 16px;
            }

            #scriptInputsContainer {
                max-height: 400px;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .item-card {
            animation: fadeIn 0.5s ease forwards;
        }
    </style>
</head>

<body>
    <div class="header">
        <div class="logo">
            <div class="logo-text">Workshop</div>
        </div>
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input id="searchInput" type="search" placeholder="Search all content..." />
        </div>
        <div class="auth-section">
            <button id="signInBtn" class="auth-btn">
                <i class="fas fa-sign-in-alt"></i> Sign In
            </button>
            <button id="createBtn" class="create-btn">
                <i class="fas fa-plus"></i> Create New
            </button>
            <div id="userProfile" class="user-profile">
                <span id="usernameDisplay"></span>
                <button id="signOutBtn" class="sign-out-btn">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </div>
    <div class="hero-showcase">
        <div class="hero-content">
            <h1 class="hero-title">Discover Amazing Content</h1>
            <p class="hero-subtitle">Explore texture packs and Mods from the community</p>
            <div class="hero-stats">
                <div class="stat-item">
                    <i class="fas fa-cube stat-icon"></i>
                    <div class="stat-number" id="packsCount">12</div>
                    <div class="stat-label">Texture Packs</div>
                </div>
                <div class="stat-item">
                    <i class="fas fa-code stat-icon"></i>
                    <div class="stat-number" id="creationsCount">0</div>
                    <div class="stat-label">Creations</div>
                </div>
                <div class="stat-item">
                    <i class="fas fa-users stat-icon"></i>
                    <div class="stat-number">24+</div>
                    <div class="stat-label">Creators</div>
                </div>
            </div>
            <div class="hero-buttons">
                <button class="hero-btn primary" id="exploreBtn">
                    <i class="fas fa-compass"></i> Explore Content
                </button>
                <button class="hero-btn secondary" id="createHeroBtn">
                    <i class="fas fa-plus-circle"></i> Create Something
                </button>
            </div>
        </div>
        <div class="hero-featured">
            <div class="featured-carousel">
                <div class="carousel-item active">
                    <img src="data/packs/Blo3D/Blo3D.jpg" alt="Blo3D Pack" class="featured-image">
                    <div class="featured-overlay">
                        <h3>Blo3D Texture Pack</h3>
                        <p>Make every block look 3D!</p>
                        <span class="featured-tag">Featured</span>
                    </div>
                </div>
                <div class="carousel-item">
                    <img src="data/packs/Monochrome/Monochrome.jpg" alt="Chrome Mono Pack" class="featured-image">
                    <div class="featured-overlay">
                        <h3>Chrome Mono</h3>
                        <p>Premium monochrome visuals</p>
                        <span class="featured-tag">Popular</span>
                    </div>
                </div>
                <div class="carousel-item">
                    <div class="featured-placeholder">
                        <i class="fas fa-code featured-icon"></i>
                    </div>
                    <div class="featured-overlay">
                        <h3>JavaScript Mods</h3>
                        <p>Share your code with the community</p>
                        <span class="featured-tag">New</span>
                    </div>
                </div>
            </div>
            <div class="carousel-nav">
                <button class="nav-btn active" data-slide="0"></button>
                <button class="nav-btn" data-slide="1"></button>
                <button class="nav-btn" data-slide="2"></button>
            </div>
        </div>
    </div>
    <div class="navigation-tabs">
        <button class="tab-btn active" data-tab="all">
            <i class="fas fa-th-large"></i> All Content
        </button>
        <button class="tab-btn" data-tab="texture">
            <i class="fas fa-cube"></i> Texture Packs
        </button>
        <button class="tab-btn" data-tab="creation">
            <i class="fas fa-code"></i> Mods
        </button>
    </div>
    <div class="content-sections">
        <div id="texture-section" class="section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-cube"></i> Texture Packs
                    <span id="textureCount" class="section-count"></span>
                </h2>
                <div class="section-controls">
                    <select id="textureSort" class="sort-select">
                        <option value="pinned-alpha">Featured & A-Z</option>
                        <option value="alpha">A-Z</option>
                        <option value="newest">Newest</option>
                    </select>
                </div>
            </div>
            <div id="textureGrid" class="item-grid">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading texture packs...</p>
                </div>
            </div>
        </div>
        <div id="creation-section" class="section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-code"></i> JavaScript Creations
                    <span id="creationCount" class="section-count"></span>
                </h2>
                <div class="section-controls">
                    <select id="creationSort" class="sort-select">
                        <option value="pinned-alpha">Featured & A-Z</option>
                        <option value="alpha">A-Z</option>
                        <option value="newest">Newest</option>
                    </select>
                </div>
            </div>
            <div id="creationGrid" class="item-grid">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading creations...</p>
                </div>
            </div>
        </div>
    </div>
    <div id="createModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create New JavaScript Creation</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <form id="upload-form">
                    <div class="form-columns">
                        <div class="form-column left">
                            <div class="form-group">
                                <label for="title"><i class="fas fa-heading"></i> Title</label>
                                <input type="text" id="title" name="title"
                                    placeholder="Enter a creative title for your creation" maxlength="100" required>
                                <div class="form-hint">Maximum 100 characters</div>
                            </div>
                            <div class="form-group">
                                <label for="username"><i class="fas fa-user"></i> Username</label>
                                <input type="text" id="username" name="username" placeholder="Enter your username"
                                    required>
                            </div>
                            <div class="form-group">
                                <label for="description"><i class="fas fa-align-left"></i> Description</label>
                                <textarea id="description" name="description" rows="3"
                                    placeholder="Enter a description for your creation" maxlength="500"></textarea>
                                <div class="form-hint">Maximum 500 characters</div>
                            </div>
                            <div class="form-group">
                                <label for="preset-icon"><i class="fas fa-icons"></i> Select Icon</label>
                                <div class="icon-selector-container">
                                    <input type="hidden" id="preset-icon" name="preset-icon" required>
                                    <div id="selectedIcon" class="selected-icon-placeholder">
                                        <span>Click to select an icon</span>
                                    </div>
                                    <button type="button" id="openIconSelector" class="icon-selector-btn">
                                        <i class="fas fa-icons"></i> Choose Icon
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="form-column right">
                            <div id="scriptInputsContainer" class="form-group"></div>
                        </div>
                    </div>
                    <div id="iconSelectorModal" class="icon-selector-modal">
                        <div class="icon-selector-content">
                            <div class="modal-header">
                                <h2><i class="fas fa-icons"></i> Select an Icon</h2>
                                <span class="close-icon-selector">&times;</span>
                            </div>
                            <div class="modal-body">
                                <div class="icon-search">
                                    <input type="text" id="iconSearch" placeholder="Search icons...">
                                </div>
                                <div id="iconGrid" class="icon-grid">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="cancel-btn" id="cancelUpload">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button type="submit" class="submit-btn">
                            <i class="fas fa-cloud-upload-alt"></i> Publish Creation
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="detailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="detailsTitle">Item Details</h2>
                <span class="close" id="detailsClose">&times;</span>
            </div>
            <div class="modal-body">
                <div id="detailsContent"></div>
                <button id="copyScriptBtn" class="submit-btn" style="margin-top: 20px;">
                    <i class="fas fa-copy"></i> Copy JavaScript
                </button>
            </div>
        </div>
    </div>
    <div id="sharePopup" class="share-popup">
        <div class="share-popup-content">
            <div class="share-popup-header">
                <h2 class="share-popup-title">Share This Item</h2>
                <button class="close-share-popup">&times;</button>
            </div>
            <img id="sharePackImage" class="share-pack-image" src="" alt="Item Preview">
            <h3 id="sharePackTitle" class="share-pack-title"></h3>
            <p id="sharePackAuthor" class="share-pack-author"></p>
            <p id="sharePackDescription" class="share-pack-description"></p>
            <div class="share-url-container">
                <input type="text" id="shareUrlInput" class="share-url-input" readonly>
                <button id="copyShareUrlBtn" class="copy-share-url-btn">Copy</button>
            </div>
            <a id="shareDownloadBtn" class="share-download-btn" target="_blank" rel="noopener noreferrer">
                <i class="fas fa-download"></i> Download Item
            </a>
        </div>
    </div>
    <script>
        try {
            const SUPABASE_URL = 'https://eytqkzsqauvgbeblgtuz.supabase.co';
            const SUPABASE_KEY = 'sb_publishable_E9VC8Pk2_P6psmFPhu_t9w_8MolXBDi';
            window.supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        } catch (error) {
            console.error('Supabase initialization error:', error);
            // Create a mock supabase object with stub methods to prevent crashes
            window.supabase = {
                from: function() {
                    return {
                        select: function() {
                            return { data: [], error: null };
                        },
                        insert: function() {
                            return { data: [], error: { message: 'Supabase not initialized' } };
                        }
                    };
                }
            };
        }
        const swearWords = [
            'fuck', 'fucking', 'fucked', 'fuckin', 'fucker', 'fucks',
            'shit', 'shitting', 'shitty', 'shat',
            'damn', 'dammit',
            'hell',
            'crap',
            'piss', 'pissing',
            'ass', 'asshole', 'asses',
            'bitch', 'bitches', 'bitching',
            'bastard', 'bastards',
            'dick', 'dicks', 'dickhead',
            'cock', 'cocks',
            'pussy', 'pussies',
            'cunt', 'cunts',
            'whore', 'whores',
            'slut', 'sluts',
            'twat', 'twats',
            'wanker', 'wankers', 'wanking',
            'bollocks',
            'bugger',
            'prick', 'pricks',
            'arse', 'arses', 'arsehole',
            'balls', 'ballz', 'ballsack',
            'bastards',
            'bellend',
            'biatch',
            'bitchy',
            'blowjob', 'blowjobs',
            'boner', 'boners',
            'boob', 'boobs', 'boobies', 'boobie',
            'buggering',
            'bullshit',
            'butthole', 'buttholes',
            'buttplug', 'buttplugs',
            'clit', 'clitoris',
            'cockhead', 'cocksucker',
            'cum', 'cumming', 'cums',
            'cuntface',
            'damnation',
            'dildo', 'dildos',
            'douche', 'douchebag',
            'dyke', 'dykes',
            'fag', 'faggot', 'fags',
            'fanny', 'fannies',
            'felching',
            'fellate', 'fellatio',
            'flange',
            'frigger',
            'fudgepacker',
            'godammit', 'goddammit', 'goddamn',
            'hellhole',
            'homo', 'homos',
            'hooker', 'hookers',
            'jackass', 'jackasses',
            'jerkoff', 'jerkoffs',
            'jizz',
            'knob', 'knobend', 'knobber',
            'kunt', 'kunts',
            'lesbo', 'lesbos',
            'lezbo', 'lezbos',
            'masturbate', 'masturbating',
            'minge',
            'muff',
            'nigga', 'niggas', 'nigger', 'niggers',
            'nobjockey',
            'nutsack',
            'orgasm', 'orgasms',
            'pecker', 'peckers',
            'penis', 'penises',
            'pissflaps',
            'poop', 'poopy',
            'porn', 'porno',
            'prickteaser',
            'punani', 'punanni',
            'pussyfart',
            'queer', 'queers',
            'rape', 'raped', 'rapist',
            'rectum',
            'retard', 'retarded',
            'rimjob',
            'schlong', 'schlongs',
            'scrotum',
            'sex', 'sexing',
            'shitface', 'shithead',
            'slag', 'slags',
            'spunk',
            'testicle', 'testicles',
            'titties', 'titty', 'tits', 'tit',
            'tosser',
            'tramp',
            'turd',
            'twunter',
            'vagina', 'vaginas',
            'vajayjay',
            'wank', 'wanking',
            'whorehouse',
            'xrated',
            'xxx'
        ];
        const iconOptions = [
            { class: 'fas fa-heart', name: 'Heart' },
            { class: 'fas fa-star', name: 'Star' },
            { class: 'fas fa-moon', name: 'Moon' },
            { class: 'fas fa-sun', name: 'Sun' },
            { class: 'fas fa-cloud', name: 'Cloud' },
            { class: 'fas fa-tree', name: 'Tree' },
            { class: 'fas fa-mountain', name: 'Mountain' },
            { class: 'fas fa-water', name: 'Water' },
            { class: 'fas fa-fire', name: 'Fire' },
            { class: 'fas fa-bolt', name: 'Lightning' },
            { class: 'fas fa-car', name: 'Car' },
            { class: 'fas fa-plane', name: 'Plane' },
            { class: 'fas fa-ship', name: 'Ship' },
            { class: 'fas fa-motorcycle', name: 'Motorcycle' },
            { class: 'fas fa-bicycle', name: 'Bicycle' },
            { class: 'fas fa-home', name: 'House' },
            { class: 'fas fa-building', name: 'Building' },
            { class: 'fas fa-city', name: 'City' },
            { class: 'fas fa-robot', name: 'Robot' },
            { class: 'fas fa-dragon', name: 'Dragon' },
            { class: 'fas fa-crown', name: 'Crown' },
            { class: 'fas fa-gem', name: 'Gem' },
            { class: 'fas fa-key', name: 'Key' },
            { class: 'fas fa-lock', name: 'Lock' },
            { class: 'fas fa-unlock', name: 'Unlock' },
            { class: 'fas fa-book', name: 'Book' },
            { class: 'fas fa-bookmark', name: 'Bookmark' },
            { class: 'fas fa-pen', name: 'Pen' },
            { class: 'fas fa-paint-brush', name: 'Paint Brush' },
            { class: 'fas fa-camera', name: 'Camera' },
            { class: 'fas fa-music', name: 'Music' },
            { class: 'fas fa-gamepad', name: 'Gamepad' },
            { class: 'fas fa-football-ball', name: 'Football' },
            { class: 'fas fa-basketball-ball', name: 'Basketball' },
            { class: 'fas fa-baseball-ball', name: 'Baseball' },
            { class: 'fas fa-tennis-ball', name: 'Tennis' },
            { class: 'fas fa-apple-alt', name: 'Apple' },
            { class: 'fas fa-lemon', name: 'Lemon' },
            { class: 'fas fa-pepper-hot', name: 'Pepper' },
            { class: 'fas fa-ice-cream', name: 'Ice Cream' },
            { class: 'fas fa-cookie', name: 'Cookie' },
            { class: 'fas fa-coffee', name: 'Coffee' },
            { class: 'fas fa-wine-bottle', name: 'Wine' },
            { class: 'fas fa-beer', name: 'Beer' },
            { class: 'fas fa-glass-whiskey', name: 'Whiskey' }
        ];
        let allTpacks = [
            {
                id: "smooth8",
                title: "Smooth 8",
                author: "Facet",
                description: "A smooth 8x texture pack with clean visuals and optimized performance.",
                imageUrl: "data/packs/Smooth 8/banner.png",
                downloadUrl: "data/packs/Smooth 8/Smooth 8 .zip",
                pinned: false,
                type: "texture"
            },
            {
                id: "jambloxdsplus",
                title: "jambloxds Plus",
                author: "jambloxd",
                description: "An 8x8 tpack with a soft cloudy skybox, armour textures, mob remodels, and a crisp UI.",
                imageUrl: "data/packs/jambloxds Plus/banner.png",
                downloadUrl: "data/packs/jambloxds Plus/jambloxds Plus.zip",
                pinned: false,
                type: "texture"
            },
            {
                id: "sunset16x",
                title: "Sunset 16x",
                author: "Nearlynothing",
                description: "Sunset 16x is an intricate and smooth texture pack made for specific gamemodes.",
                imageUrl: "data/packs/Sunset 16x/banner.png",
                downloadUrl: "data/packs/Sunset 16x/Sunset 16x .zip",
                pinned: false,
                type: "texture"
            },
            {
                id: "monochrome",
                title: "Chrome Mono",
                author: "Endur",
                description: "Chrome Mono is one of the best texture packs for Bloxd.io, offering a premium experience with sleek monochrome visuals. Transform your gaming experience with high-quality textures that provide both style and clarity.",
                imageUrl: "data/packs/Monochrome/Monochrome.jpg",
                downloadUrl: "data/packs/Monochrome/Monochrome8x.zip",
                pinned: true,
                type: "texture"
            },
            {
                id: "blo3d",
                title: "Blo3D",
                author: "Facet",
                description: "A pack that makes every block and item in the game look 3D! Experience Bloxd.io like never before with stunning three-dimensional visuals that bring depth and realism to your gameplay.",
                imageUrl: "data/packs/Blo3D/Blo3D.jpg",
                downloadUrl: "data/packs/Blo3D/Blo3D.zip",
                pinned: true,
                type: "texture"
            },
            {
                id: "sleekslots",
                title: "SleekSlots",
                author: "Facet",
                description: "Make your inventory smaller and easier to use! This streamlined UI pack optimizes your inventory interface for better accessibility and improved gameplay experience.",
                imageUrl: "data/packs/Sleekslots/SleekSlots.jpg",
                downloadUrl: "data/packs/Sleekslots/SleekSlots.zip",
                pinned: true,
                type: "texture"
            },
            {
                id: "burnt16",
                title: "Burnt16",
                author: "Endur",
                description: "Pink themed pack with nice textures, a skybox, nice UI, and models. Made for PvP and bedwars with stunning visual enhancements that give you the competitive edge.",
                imageUrl: "data/packs/Burnt16/Burnt16.jpg",
                downloadUrl: "data/packs/Burnt16/Burnt16x.zip",
                pinned: false,
                type: "texture"
            },
            {
                id: "fadefyre",
                title: "FadeFyre VX1",
                author: "Infernal",
                description: "FadeFyre VX1 is a texture pack that includes a detailed skybox, custom models, improved textures, and a redesigned HUD for items. The wool textures are also well-made, adding more depth to builds.",
                imageUrl: "data/packs/FadeFyre/FadeFyre.jpg",
                downloadUrl: "data/packs/FadeFyre/FadeFyreVX1.zip",
                pinned: false,
                type: "texture"
            },
            {
                id: "Destiny",
                title: "Destiny",
                author: "ArtCombo",
                description: "Monochrome red recolour, originaly by Endur",
                imageUrl: "data/packs/Destiny/Destiny.png",
                downloadUrl: "data/packs/Destiny/Destiny.zip",
                pinned: false,
                type: "texture"
            },
            {
                id: "hyperxray",
                title: "HyperXray",
                author: "Facet",
                description: "The Hyper Xray enhances your gameplay by allowing you to easily see ores, making resource gathering more efficient. It also provides the ability to detect underground bases and helps you quickly identify murderers in Murder Mystery.",
                imageUrl: "data/packs/HyperXray/HyperXray.jpg",
                downloadUrl: "data/packs/HyperXray/HyperXray.zip",
                pinned: false,
                type: "texture"
            },
            {
                id: "kosmos",
                title: "Kosmos 128x",
                author: "Infernal",
                description: "Kosmos 128x is a high-resolution, visually appealing texture pack designed specifically for BedWars and SkyWars, enhancing gameplay with its refined aesthetics and crisp visual quality.",
                imageUrl: "data/packs/Kosmos/Kosmos.jpg",
                downloadUrl: "data/packs/Kosmos/Kosmos18x.zip",
                pinned: false,
                type: "texture"
            },
            {
                id: "golde",
                title: "Golde v2",
                author: "Endur",
                description: "Gold themed pack with nice textures. Made for PvP and bedwars with luxurious golden aesthetics that make your gameplay experience shine with elegance and style.",
                imageUrl: "data/packs/golde/Golde v2.jpg",
                downloadUrl: "data/packs/golde/Goldev2.zip",
                pinned: false,
                type: "texture"
            }
        ];
        let grid, searchInput;
        let signInBtn, signOutBtn, userProfile, usernameDisplay, usernameInput;
        let createBtn, modal, closeBtn;
        let uploadForm;
        let openIconSelectorBtn, iconSelectorModal, closeIconSelector, iconGrid, iconSearch, selectedIconDisplay, presetIconInput;
        let sharePopup, closeSharePopup, sharePackImage, sharePackTitle, sharePackAuthor, sharePackDescription;
        let shareUrlInput, copyShareUrlBtn, shareDownloadBtn;
        let detailsModal, detailsTitle, detailsContent, copyScriptBtn, detailsClose;
        let textureSection, creationSection, textureGrid, creationGrid;
        let textureCount, creationCount, textureSort, creationSort;
        let tabButtons;
        let exploreBtn, createHeroBtn, navButtons, carouselItems;
        let packsCount, creationsCount;
        let allSubmissions = [];
        let selectedIcon = null;
        let lastUploadTime = 0;
        let followedCreators = new Set();
        const UPLOAD_COOLDOWN = 30000;
        let currentTab = 'all';
        let currentSlide = 0;
        let carouselInterval;
        function setupUploadForm() {
            const form = document.getElementById('upload-form');
            const scriptContainer = document.getElementById('scriptInputsContainer');
            if (scriptContainer) {
                scriptContainer.innerHTML = '';
            }
            const rightColumn = form.querySelector('.form-column.right');
            if (rightColumn) {
                const existingHeader = rightColumn.querySelector('h3');
                if (!existingHeader) {
                    const scriptHeader = document.createElement('h3');
                    scriptHeader.innerHTML = '<i class="fas fa-code"></i> JavaScript Scripts';
                    scriptHeader.style.color = 'var(--text-accent)';
                    scriptHeader.style.marginBottom = '15px';
                    scriptHeader.style.fontWeight = '600';
                    rightColumn.insertBefore(scriptHeader, scriptContainer);
                }
            }
            if (scriptContainer) {
                addScriptInput(scriptContainer);
            }
            const addButton = document.createElement('button');
            addButton.type = 'button';
            addButton.className = 'submit-btn';
            addButton.innerHTML = '<i class="fas fa-plus"></i> Add Another Script';
            addButton.onclick = () => {
                if (scriptContainer) {
                    addScriptInput(scriptContainer);
                }
            };
            addButton.style.marginTop = '10px';
            addButton.style.marginBottom = '20px';
            addButton.style.alignSelf = 'stretch';
            addButton.style.height = '40px';
            if (rightColumn) {
                rightColumn.appendChild(addButton);
            }
        }
        function addScriptInput(container) {
            const scriptCount = container.querySelectorAll('.script-input-group').length + 1;
            const inputGroup = document.createElement('div');
            inputGroup.className = 'script-input-group';
            inputGroup.style.marginBottom = '12px';
            inputGroup.style.padding = '12px';
            inputGroup.style.border = '1px solid var(--border-color)';
            inputGroup.style.borderRadius = 'var(--radius-md)';
            inputGroup.style.backgroundColor = 'var(--background-darker)';
            inputGroup.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <label style="font-weight: 600; color: var(--text-accent); font-size: 1.1rem;">
                        <i class="fas fa-file-code"></i> Script #${scriptCount}
                    </label>
                    <button type="button" class="cancel-btn" onclick="this.closest('.script-input-group').remove()" 
                            style="padding: 5px 10px; font-size: 0.9rem; width: auto; max-width: 100px; height: 30px;">
                        <i class="fas fa-trash"></i> Remove
                    </button>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="scriptName${scriptCount}"><i class="fas fa-tag"></i> Script Type</label>
                            <select id="scriptName${scriptCount}" name="scriptName${scriptCount}" required>
                                <option value="World code">World code</option>
                                <option value="Code block">Code block</option>
                            </select>
                            <div class="form-hint">Select the type of script</div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="script${scriptCount}"><i class="fab fa-js"></i> JavaScript Code</label>
                    <textarea id="script${scriptCount}" name="script${scriptCount}" rows="4" 
                              placeholder="Enter your JavaScript code here..." maxlength="10000" required style="max-height: 150px;"></textarea>
                    <div class="form-hint">Make sure the code works before uploading (maximum 10,000 characters)</div>
                </div>
            `;
            container.appendChild(inputGroup);
        }
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                console.log('DOM loaded, initializing app...');
                initializeDOMElements();
                checkAuthStatus();
                initializeTexturePackData();
                setupEventListeners();
                setupUploadForm();
                setupIconSelector();
                initHeroCarousel();
                // Ensure create button is hidden if Puter is not available
                if (createBtn && (typeof puter === 'undefined' || !puter.auth)) {
                    createBtn.style.display = 'none';
                }
                await loadSubmissions();
                updateTabView(); // Make sure to update the tab view after loading
                console.log('App initialized successfully');
            } catch (error) {
                console.error('Error during DOMContentLoaded:', error);
            }
        });
        function initializeDOMElements() {
            try {
                searchInput = document.getElementById('searchInput');
                signInBtn = document.getElementById('signInBtn');
                signOutBtn = document.getElementById('signOutBtn');
                userProfile = document.getElementById('userProfile');
                usernameDisplay = document.getElementById('usernameDisplay');
                usernameInput = document.getElementById('username');
                createBtn = document.getElementById('createBtn');
                modal = document.getElementById('createModal');
                closeBtn = document.querySelector('.close');
                uploadForm = document.getElementById('upload-form');
                openIconSelectorBtn = document.getElementById('openIconSelector');
                iconSelectorModal = document.getElementById('iconSelectorModal');
                closeIconSelector = document.querySelector('.close-icon-selector');
                iconGrid = document.getElementById('iconGrid');
                iconSearch = document.getElementById('iconSearch');
                selectedIconDisplay = document.getElementById('selectedIcon');
                presetIconInput = document.getElementById('preset-icon');
                sharePopup = document.getElementById('sharePopup');
                closeSharePopup = document.querySelector('.close-share-popup');
                sharePackImage = document.getElementById('sharePackImage');
                sharePackTitle = document.getElementById('sharePackTitle');
                sharePackAuthor = document.getElementById('sharePackAuthor');
                sharePackDescription = document.getElementById('sharePackDescription');
                shareUrlInput = document.getElementById('shareUrlInput');
                copyShareUrlBtn = document.getElementById('copyShareUrlBtn');
                shareDownloadBtn = document.getElementById('shareDownloadBtn');
                detailsModal = document.getElementById('detailsModal');
                detailsTitle = document.getElementById('detailsTitle');
                detailsContent = document.getElementById('detailsContent');
                copyScriptBtn = document.getElementById('copyScriptBtn');
                detailsClose = document.getElementById('detailsClose');
                textureSection = document.getElementById('texture-section');
                creationSection = document.getElementById('creation-section');
                textureGrid = document.getElementById('textureGrid');
                creationGrid = document.getElementById('creationGrid');
                textureCount = document.getElementById('textureCount');
                creationCount = document.getElementById('creationCount');
                textureSort = document.getElementById('textureSort');
                creationSort = document.getElementById('creationSort');
                tabButtons = document.querySelectorAll('.tab-btn');
                exploreBtn = document.getElementById('exploreBtn');
                createHeroBtn = document.getElementById('createHeroBtn');
                navButtons = document.querySelectorAll('.nav-btn');
                carouselItems = document.querySelectorAll('.carousel-item');
                packsCount = document.getElementById('packsCount');
                creationsCount = document.getElementById('creationsCount');
                
                // Log which elements were not found to help with debugging
                const missingElements = [];
                if (!searchInput) missingElements.push('searchInput');
                if (!signInBtn) missingElements.push('signInBtn');
                if (!signOutBtn) missingElements.push('signOutBtn');
                if (!userProfile) missingElements.push('userProfile');
                if (!usernameDisplay) missingElements.push('usernameDisplay');
                if (!usernameInput) missingElements.push('usernameInput');
                if (!createBtn) missingElements.push('createBtn');
                if (!modal) missingElements.push('modal');
                if (!closeBtn) missingElements.push('closeBtn');
                if (!uploadForm) missingElements.push('uploadForm');
                if (!openIconSelectorBtn) missingElements.push('openIconSelectorBtn');
                if (!iconSelectorModal) missingElements.push('iconSelectorModal');
                if (!closeIconSelector) missingElements.push('closeIconSelector');
                if (!iconGrid) missingElements.push('iconGrid');
                if (!iconSearch) missingElements.push('iconSearch');
                if (!selectedIconDisplay) missingElements.push('selectedIconDisplay');
                if (!presetIconInput) missingElements.push('presetIconInput');
                if (!sharePopup) missingElements.push('sharePopup');
                if (!closeSharePopup) missingElements.push('closeSharePopup');
                if (!sharePackImage) missingElements.push('sharePackImage');
                if (!sharePackTitle) missingElements.push('sharePackTitle');
                if (!sharePackAuthor) missingElements.push('sharePackAuthor');
                if (!sharePackDescription) missingElements.push('sharePackDescription');
                if (!shareUrlInput) missingElements.push('shareUrlInput');
                if (!copyShareUrlBtn) missingElements.push('copyShareUrlBtn');
                if (!shareDownloadBtn) missingElements.push('shareDownloadBtn');
                if (!detailsModal) missingElements.push('detailsModal');
                if (!detailsTitle) missingElements.push('detailsTitle');
                if (!detailsContent) missingElements.push('detailsContent');
                if (!copyScriptBtn) missingElements.push('copyScriptBtn');
                if (!detailsClose) missingElements.push('detailsClose');
                if (!textureSection) missingElements.push('textureSection');
                if (!creationSection) missingElements.push('creationSection');
                if (!textureGrid) missingElements.push('textureGrid');
                if (!creationGrid) missingElements.push('creationGrid');
                if (!textureCount) missingElements.push('textureCount');
                if (!creationCount) missingElements.push('creationCount');
                if (!textureSort) missingElements.push('textureSort');
                if (!creationSort) missingElements.push('creationSort');
                if (!exploreBtn) missingElements.push('exploreBtn');
                if (!createHeroBtn) missingElements.push('createHeroBtn');
                if (!packsCount) missingElements.push('packsCount');
                if (!creationsCount) missingElements.push('creationsCount');
                
                if (missingElements.length > 0) {
                    console.warn('Missing elements in workshop:', missingElements);
                }
                
                console.log('DOM elements initialized. Found:', {
                    tabButtons: tabButtons.length,
                    navButtons: navButtons.length,
                    carouselItems: carouselItems.length
                });
            } catch (error) {
                console.error('Error initializing DOM elements:', error);
            }
        }
        function setupEventListeners() {
            try {
                if (signInBtn) {
                    signInBtn.addEventListener('click', handleSignIn);
                    console.log('Sign in button listener attached');
                }
                if (signOutBtn) {
                    signOutBtn.addEventListener('click', handleSignOut);
                    console.log('Sign out button listener attached');
                }
                if (createBtn) {
                    createBtn.addEventListener('click', () => {
                        console.log('Create button clicked');
                        if (modal) modal.style.display = 'block';
                    });
                    console.log('Create button listener attached');
                }
                if (closeBtn) {
                    closeBtn.addEventListener('click', () => {
                        console.log('Close button clicked');
                        if (modal) modal.style.display = 'none';
                    });
                    console.log('Close button listener attached');
                }
                const cancelBtn = document.getElementById('cancelUpload');
                if (cancelBtn) {
                    cancelBtn.addEventListener('click', () => {
                        if (modal) modal.style.display = 'none';
                    });
                    console.log('Cancel button listener attached');
                }
                if (uploadForm) {
                    uploadForm.addEventListener('submit', handleFormSubmit);
                    console.log('Upload form listener attached');
                }
                window.addEventListener('click', (event) => {
                    if (modal && event.target === modal) {
                        console.log('Clicked outside modal');
                        modal.style.display = 'none';
                    }
                    if (iconSelectorModal && event.target === iconSelectorModal) {
                        iconSelectorModal.style.display = 'none';
                    }
                    if (detailsModal && event.target === detailsModal) {
                        detailsModal.style.display = 'none';
                    }
                    if (sharePopup && event.target === sharePopup) {
                        sharePopup.style.display = 'none';
                    }
                });
                if (searchInput) {
                    searchInput.addEventListener('input', handleSearch);
                    console.log('Search input listener attached');
                }
                if (closeSharePopup) {
                    closeSharePopup.addEventListener('click', () => {
                        if (sharePopup) sharePopup.style.display = 'none';
                    });
                    console.log('Close share popup listener attached');
                }
                if (copyShareUrlBtn) {
                    copyShareUrlBtn.addEventListener('click', () => {
                        if (shareUrlInput) {
                            shareUrlInput.select();
                            document.execCommand('copy');
                            const originalText = copyShareUrlBtn.textContent;
                            copyShareUrlBtn.textContent = 'Copied!';
                            setTimeout(() => {
                                copyShareUrlBtn.textContent = originalText;
                            }, 2000);
                        }
                    });
                    console.log('Copy share URL button listener attached');
                }
                if (detailsClose) {
                    detailsClose.addEventListener('click', () => {
                        if (detailsModal) detailsModal.style.display = 'none';
                    });
                    console.log('Details close button listener attached');
                }
                if (tabButtons) {
                    tabButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            tabButtons.forEach(btn => btn.classList.remove('active'));
                            button.classList.add('active');
                            currentTab = button.dataset.tab;
                            updateTabView();
                        });
                    });
                    console.log('Tab buttons listeners attached');
                }
                if (textureSort) {
                    textureSort.addEventListener('change', () => {
                        renderTexturePacks();
                    });
                    console.log('Texture sort listener attached');
                }
                if (creationSort) {
                    creationSort.addEventListener('change', () => {
                        renderCreations();
                    });
                    console.log('Creation sort listener attached');
                }
                if (exploreBtn) {
                    exploreBtn.addEventListener('click', () => {
                        document.querySelector('.content-sections').scrollIntoView({ behavior: 'smooth' });
                    });
                    console.log('Explore button listener attached');
                }
                if (createHeroBtn) {
                    createHeroBtn.addEventListener('click', () => {
                        if (createBtn) createBtn.click();
                    });
                    console.log('Create hero button listener attached');
                }
                if (navButtons) {
                    navButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            const slideIndex = parseInt(button.dataset.slide);
                            showSlide(slideIndex);
                        });
                    });
                    console.log('Navigation buttons listeners attached');
                }
                
                console.log('All event listeners have been set up');
            } catch (error) {
                console.error('Error setting up event listeners:', error);
            }
        }
        function initHeroCarousel() {
            if (packsCount) packsCount.textContent = allTpacks.length;
            if (creationsCount) creationsCount.textContent = allSubmissions.length;
            carouselInterval = setInterval(() => {
                currentSlide = (currentSlide + 1) % carouselItems.length;
                showSlide(currentSlide);
            }, 5000);
        }
        function showSlide(index) {
            carouselItems.forEach((item, i) => {
                if (i === index) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            navButtons.forEach((button, i) => {
                if (i === index) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });
            currentSlide = index;
        }
        function updateTabView() {
            switch (currentTab) {
                case 'all':
                    if (textureSection) textureSection.style.display = 'block';
                    if (creationSection) creationSection.style.display = 'block';
                    break;
                case 'texture':
                    if (textureSection) textureSection.style.display = 'block';
                    if (creationSection) creationSection.style.display = 'none';
                    break;
                case 'creation':
                    if (textureSection) textureSection.style.display = 'none';
                    if (creationSection) creationSection.style.display = 'block';
                    break;
            }
            if (currentTab === 'all' || currentTab === 'texture') {
                renderTexturePacks();
            }
            if (currentTab === 'all' || currentTab === 'creation') {
                renderCreations();
            }
        }
        function setupIconSelector() {
            console.log('Setting up icon selector');
            if (openIconSelectorBtn && iconSelectorModal && closeIconSelector) {
                console.log('Icon selector elements found, setting up event listeners');
                openIconSelectorBtn.addEventListener('click', openIconSelector);
                closeIconSelector.addEventListener('click', closeIconSelectorModal);
                if (iconSearch) {
                    iconSearch.addEventListener('input', filterIcons);
                }
                renderIconGrid(iconOptions);
            } else {
                console.log('Icon selector elements not found');
            }
        }
        function openIconSelector() {
            console.log('Opening icon selector');
            if (iconSelectorModal) {
                iconSelectorModal.style.display = 'block';
                filterIcons();
            } else {
                console.error('Icon selector modal not found');
                alert('Unable to open icon selector. Please try again.');
            }
        }
        function closeIconSelectorModal() {
            console.log('Closing icon selector');
            if (iconSelectorModal) {
                iconSelectorModal.style.display = 'none';
            }
        }
        function renderIconGrid(icons) {
            if (!iconGrid) {
                iconGrid = document.getElementById('iconGrid');
                console.log('Fallback - iconGrid:', !!iconGrid);
            }
            if (!iconGrid) {
                console.error('Icon grid element not found');
                return;
            }
            iconGrid.innerHTML = '';
            icons.forEach(icon => {
                const iconElement = document.createElement('div');
                iconElement.className = 'icon-item';
                if (selectedIcon && selectedIcon.class === icon.class) {
                    iconElement.classList.add('selected');
                }
                iconElement.innerHTML = `
            <i class="${icon.class}"></i>
            <div class="icon-name">${icon.name}</div>
        `;
                iconElement.addEventListener('click', () => {
                    selectIcon(icon);
                });
                iconGrid.appendChild(iconElement);
            });
        }
        function filterIcons() {
            if (!iconSearch) {
                console.error('Icon search element not found');
                return;
            }
            const searchTerm = iconSearch.value.toLowerCase();
            const filteredIcons = iconOptions.filter(icon =>
                icon.name.toLowerCase().includes(searchTerm) ||
                icon.class.toLowerCase().includes(searchTerm)
            );
            renderIconGrid(filteredIcons);
        }
        function selectIcon(icon) {
            selectedIcon = icon;
            if (presetIconInput) {
                presetIconInput.value = icon.class;
            }
            if (selectedIconDisplay) {
                selectedIconDisplay.innerHTML = `<i class="${icon.class}" style="font-size: 3rem; color: #f78c5a;"></i>`;
            }
            closeIconSelectorModal();
            const iconItems = document.querySelectorAll('.icon-item');
            iconItems.forEach(item => {
                item.classList.remove('selected');
                const iconElement = item.querySelector('i');
                if (iconElement && iconElement.classList.contains(icon.class)) {
                    item.classList.add('selected');
                }
            });
        }
        function containsSwearWords(text) {
            const lowerText = text.toLowerCase();
            return swearWords.some(word => {
                const regex = new RegExp('\\b' + word.replace(/(.)/g, '$1[\\W_]*') + '\\b', 'i');
                return regex.test(lowerText);
            });
        }
        function sanitizeText(text) {
            let sanitizedText = text;
            swearWords.forEach(word => {
                const regex = new RegExp('\\b' + word + '\\b', 'gi');
                sanitizedText = sanitizedText.replace(regex, '*'.repeat(word.length));
            });
            return sanitizedText;
        }
        async function handleSignIn() {
            try {
                // Check if Puter SDK is available
                if (typeof puter === 'undefined' || !puter.auth) {
                    console.error('Puter SDK not loaded. Please check the CDN link.');
                    alert('Authentication service is not available. Please try again later.');
                    return;
                }
                console.log('Signing in with Puter...');
                const user = await puter.auth.signIn();
                if (user instanceof Error) {
                    console.error('Puter SDK not loaded properly:', user);
                    alert('Authentication service is not available. Please try again later.');
                    return;
                }
                console.log('Signed in user:', user);
                if (signInBtn) signInBtn.style.display = 'none';
                if (createBtn) createBtn.style.display = 'flex';
                if (userProfile) userProfile.style.display = 'flex';
                if (usernameDisplay) usernameDisplay.textContent = user.username;
                if (usernameInput) {
                    usernameInput.value = user.username;
                    usernameInput.readOnly = true;
                }
                localStorage.setItem('puterUser', JSON.stringify(user));
                
                // Update UI to reflect successful sign-in
                if (createBtn) createBtn.style.display = 'flex';
                if (signInBtn) signInBtn.style.display = 'none';
                if (userProfile) {
                    userProfile.style.display = 'flex';
                    if (usernameDisplay) usernameDisplay.textContent = user.username;
                }
                
                // Show success notification
                showNotification('Successfully signed in!', 'success');
            } catch (error) {
                console.error('Sign in error:', error);
                alert('Sign in failed. Please try again. Error: ' + error.message);
                
                // Show error notification
                showNotification('Sign in failed: ' + error.message, 'error');
            }
        }
        function handleSignOut() {
            try {
                // Check if Puter SDK is available
                if (typeof puter === 'undefined' || !puter.auth) {
                    console.error('Puter SDK not loaded. Cannot sign out.');
                    localStorage.removeItem('puterUser');
                    if (signInBtn) signInBtn.style.display = 'flex';
                    if (createBtn) createBtn.style.display = 'none';
                    if (userProfile) userProfile.style.display = 'none';
                    
                    // Show notification
                    showNotification('Successfully signed out.', 'success');
                    return;
                }
                puter.auth.signOut();
                if (signInBtn) signInBtn.style.display = 'flex';
                if (createBtn) createBtn.style.display = 'none';
                if (userProfile) userProfile.style.display = 'none';
                if (usernameInput) {
                    usernameInput.value = '';
                    usernameInput.readOnly = false;
                }
                localStorage.removeItem('puterUser');
                
                // Update UI to reflect successful sign-out
                if (createBtn) createBtn.style.display = 'none';
                if (signInBtn) signInBtn.style.display = 'flex';
                if (userProfile) {
                    userProfile.style.display = 'none';
                    if (usernameDisplay) usernameDisplay.textContent = '';
                }
                
                // Show notification
                showNotification('Successfully signed out.', 'success');
            } catch (error) {
                console.error('Sign out error:', error);
                alert('Sign out failed. Please try again. Error: ' + error.message);
                
                // Show error notification
                showNotification('Sign out failed: ' + error.message, 'error');
            }
        }
        function checkAuthStatus() {
            try {
                const storedUser = localStorage.getItem('puterUser');
                // Check if Puter SDK is available
                const puterAvailable = typeof puter !== 'undefined' && puter.auth;
                if (storedUser && puterAvailable) {
                    const user = JSON.parse(storedUser);
                    // Update UI to reflect authenticated state
                    if (createBtn) createBtn.style.display = 'flex';
                    if (signInBtn) signInBtn.style.display = 'none';
                    if (userProfile) {
                        userProfile.style.display = 'flex';
                        if (usernameDisplay) usernameDisplay.textContent = user.username;
                    }
                    if (usernameInput) {
                        usernameInput.value = user.username;
                        usernameInput.readOnly = true;
                    }
                } else {
                    // Update UI to reflect non-authenticated state
                    if (signInBtn) signInBtn.style.display = 'flex';
                    if (createBtn) createBtn.style.display = 'none';
                    if (userProfile) userProfile.style.display = 'none';
                    // Clear any stored user if puter is not available
                    if (!puterAvailable) {
                        localStorage.removeItem('puterUser');
                    }
                }
                const storedFollows = localStorage.getItem('followedCreators');
                if (storedFollows) {
                    followedCreators = new Set(JSON.parse(storedFollows));
                }
                
                console.log('Authentication status checked:', {
                    hasStoredUser: !!storedUser,
                    puterAvailable: !!puterAvailable,
                    isAuthed: !!(storedUser && puterAvailable)
                });
            } catch (error) {
                console.error('Error checking auth status:', error);
                localStorage.removeItem('puterUser');
                // Update UI to reflect non-authenticated state
                if (signInBtn) signInBtn.style.display = 'flex';
                if (createBtn) createBtn.style.display = 'none';
                if (userProfile) userProfile.style.display = 'none';
            }
        }
        function canUpload() {
            const now = Date.now();
            const timeSinceLastUpload = now - lastUploadTime;
            return timeSinceLastUpload >= UPLOAD_COOLDOWN;
        }
        function getRemainingCooldown() {
            const now = Date.now();
            const timeSinceLastUpload = now - lastUploadTime;
            return Math.max(0, UPLOAD_COOLDOWN - timeSinceLastUpload);
        }
        function formatTime(ms) {
            return Math.ceil(ms / 1000);
        }
        async function handleFormSubmit(event) {
            event.preventDefault();
            if (!canUpload()) {
                const remainingTime = getRemainingCooldown();
                alert(`Please wait ${formatTime(remainingTime)} seconds before uploading again.`);
                return;
            }
            const submitButton = uploadForm.querySelector('button[type="submit"]');
            const originalButtonText = submitButton.textContent;
            submitButton.textContent = 'Uploading...';
            submitButton.disabled = true;
            const title = document.getElementById('title').value;
            const username = document.getElementById('username').value;
            const description = document.getElementById('description').value;
            const presetIcon = document.getElementById('preset-icon').value;
            const scriptGroups = document.querySelectorAll('.script-input-group');
            const scripts = [];
            let valid = true;
            scriptGroups.forEach((group, index) => {
                const nameSelect = group.querySelector(`select[name^="scriptName"]`);
                const codeInput = group.querySelector(`textarea[name^="script"]`);
                if (nameSelect && codeInput) {
                    const name = nameSelect.value.trim();
                    const code = codeInput.value.trim();
                    if (!name || !code) {
                        valid = false;
                        return;
                    }
                    if (name.length > 50) {
                        alert(`Script name #${index + 1} must be 50 characters or less.`);
                        valid = false;
                        return;
                    }
                    if (code.length > 10000) {
                        alert(`Script code #${index + 1} must be 10,000 characters or less.`);
                        valid = false;
                        return;
                    }
                    scripts.push({
                        name: sanitizeText(name),
                        code: code
                    });
                }
            });
            if (!valid || scripts.length === 0) {
                alert('Please fill in all script names and code fields.');
                submitButton.textContent = originalButtonText;
                submitButton.disabled = false;
                return;
            }
            if (title.length > 100) {
                alert('Title must be 100 characters or less.');
                submitButton.textContent = originalButtonText;
                submitButton.disabled = false;
                return;
            }
            if (containsSwearWords(title)) {
                alert('Your title contains inappropriate language. Please revise it before submitting.');
                submitButton.textContent = originalButtonText;
                submitButton.disabled = false;
                return;
            }
            // Check if Puter SDK is available
            if (typeof puter === 'undefined' || !puter.auth) {
                console.error('Puter SDK not loaded. Cannot upload creations.');
                alert('Authentication service is not available. Cannot upload creations.');
                submitButton.textContent = originalButtonText;
                submitButton.disabled = false;
                return;
            }
            const storedUser = localStorage.getItem('puterUser');
            if (!storedUser) {
                alert('You must be signed in to upload creations.');
                submitButton.textContent = originalButtonText;
                submitButton.disabled = false;
                return;
            }
            if (!presetIcon) {
                alert('Please select an icon for your creation.');
                submitButton.textContent = originalButtonText;
                submitButton.disabled = false;
                return;
            }
            const user = JSON.parse(storedUser);
            const submission = {
                title: sanitizeText(title),
                description: sanitizeText(description),
                username: user.username,
                preset_icon: presetIcon,
                scripts: JSON.stringify(scripts),
                created_at: new Date().toISOString(),
                user_id: user.uuid
            };
            try {
                // Check if supabase client is properly initialized
                if (!supabase) {
                    throw new Error('Supabase client is not initialized');
                }
                
                const { data, error } = await supabase
                    .from('submissions')
                    .insert([submission])
                    .select();
                console.log('Insert response:', { data, error });
                if (error) {
                    throw error;
                }
                lastUploadTime = Date.now();
                
                // Show success notification
                showNotification('Creation published successfully!', 'success');
                
                if (modal) modal.style.display = 'none';
                uploadForm.reset();
                selectedIcon = null;
                if (selectedIconDisplay) {
                    selectedIconDisplay.innerHTML = '<span>Click to select an icon</span>';
                }
                if (presetIconInput) {
                    presetIconInput.value = '';
                }
                if (document.getElementById('description')) {
                    document.getElementById('description').value = '';
                }
                const scriptContainer = document.getElementById('scriptInputsContainer');
                if (scriptContainer) {
                    scriptContainer.innerHTML = '';
                    addScriptInput(scriptContainer);
                }
                await loadSubmissions();
            } catch (error) {
                console.error('Error uploading submission:', error);
                let errorMessage = error.message || error;
                if (errorMessage.includes('row-level security policy') || errorMessage.includes('permission')) {
                    errorMessage = 'Database access error: You need to enable proper permissions in Supabase. ' +
                        'Go to your Supabase dashboard > Authentication > Policies > submissions table ' +
                        'and enable INSERT access for everyone (public).';
                } else if (errorMessage.includes('connection') || errorMessage.includes('network')) {
                    errorMessage = 'Network error: Unable to connect to database. Please check your internet connection.';
                } else if (errorMessage.includes('auth')) {
                    errorMessage = 'Authentication error: Unable to access database. Please try refreshing the page.';
                }
                
                // Show error notification
                showNotification('Error uploading submission: ' + errorMessage, 'error');
                
                alert(`Error uploading submission: ${errorMessage}`);
            } finally {
                submitButton.textContent = originalButtonText;
                submitButton.disabled = false;
            }
        }
        async function loadSubmissions() {
            console.log('Loading submissions...');
            if (allSubmissions.length === 0 && creationGrid) {
                creationGrid.innerHTML = '<div class="loading"><div class="loading-spinner"></div><p>Loading creations...</p></div>';
            }
            try {
                console.log('Attempting to connect to Supabase...');
                // Check if supabase client is properly initialized
                if (!supabase) {
                    console.error('Supabase client is not initialized');
                    throw new Error('Supabase client is not initialized');
                }
                
                const { data, error } = await supabase
                    .from('submissions')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                console.log('Supabase response:', { data, error });
                
                if (error) {
                    console.error('Supabase error details:', error);
                    throw error;
                }
                
                allSubmissions = data || [];
                console.log('Found', allSubmissions.length, 'submissions');
                updateCounts();
                renderCreations();
            } catch (error) {
                console.error('Error loading submissions:', error);
                allSubmissions = []; // Reset to empty array if there's an error
                
                let errorMessage = error.message || 'Please try again later.';
                if (errorMessage.includes('row-level security policy') || errorMessage.includes('permission')) {
                    errorMessage = 'Database access error: You need to enable proper permissions in Supabase. ' +
                        'Go to your Supabase dashboard > Authentication > Policies > submissions table ' +
                        'and enable SELECT access for everyone (public).';
                } else if (errorMessage.includes('connection') || errorMessage.includes('network')) {
                    errorMessage = 'Network error: Unable to connect to database. Please check your internet connection.';
                } else if (errorMessage.includes('auth')) {
                    errorMessage = 'Authentication error: Unable to access database. Please try refreshing the page.';
                }
                
                // Show error notification
                showNotification('Error loading creations: ' + errorMessage, 'error');
                
                // Still render the texture packs even if creations fail to load
                renderTexturePacks();
                renderCreations();
            }
        }
        function initializeTexturePackData() {
            allTpacks.sort((a, b) => {
                if (a.pinned && !b.pinned) return -1;
                if (!a.pinned && b.pinned) return 1;
                return a.title.localeCompare(b.title);
            });
            updateCounts();
        }
        function updateCounts() {
            if (textureCount) textureCount.textContent = `(${allTpacks.length})`;
            if (creationCount) creationCount.textContent = `(${allSubmissions.length})`;
            if (packsCount) packsCount.textContent = allTpacks.length;
            if (creationsCount) creationsCount.textContent = allSubmissions.length;
        }
        function toggleFollow(creator, button) {
            if (followedCreators.has(creator)) {
                followedCreators.delete(creator);
                button.innerHTML = '<i class="fas fa-user-plus"></i> Follow';
                button.classList.remove('followed');
                button.style.background = 'rgba(255, 255, 255, 0.2)';
                button.style.border = '1px solid rgba(255, 255, 255, 0.3)';
            } else {
                followedCreators.add(creator);
                button.innerHTML = '<i class="fas fa-user-check"></i> Following';
                button.classList.add('followed');
                button.style.background = '#ff6b39';
                button.style.border = 'none';
            }
            localStorage.setItem('followedCreators', JSON.stringify([...followedCreators]));
            renderCreations();
            renderFilteredCreations(allSubmissions.filter(submission => {
                const searchTerm = searchInput ? searchInput.value.toLowerCase().trim() : '';
                return submission.title.toLowerCase().includes(searchTerm) ||
                    submission.username.toLowerCase().includes(searchTerm);
            }));
        }
        function renderTexturePacks() {
            if (!textureGrid) return;
            const sortValue = textureSort ? textureSort.value : 'pinned-alpha';
            let sortedPacks = [...allTpacks];
            switch (sortValue) {
                case 'alpha':
                    sortedPacks.sort((a, b) => a.title.localeCompare(b.title));
                    break;
                case 'newest':
                    sortedPacks.sort((a, b) => a.title.localeCompare(b.title));
                    break;
                case 'pinned-alpha':
                default:
                    sortedPacks.sort((a, b) => {
                        if (a.pinned && !b.pinned) return -1;
                        if (!a.pinned && b.pinned) return 1;
                        return a.title.localeCompare(b.title);
                    });
                    break;
            }
            if (sortedPacks.length === 0) {
                textureGrid.innerHTML = `
            <div class="grid-message">
                <i class="fas fa-cube"></i>
                <h3>No texture packs available</h3>
                <p>Check back later for new texture packs!</p>
            </div>`;
                return;
            }
            textureGrid.innerHTML = '';
            sortedPacks.forEach((pack, index) => {
                const card = document.createElement('div');
                card.className = 'item-card';
                card.style.animationDelay = `${index * 0.05}s`;
                const isPinned = pack.pinned;
                const pinIcon = isPinned ? '<i class="fa-solid fa-thumbtack pin-icon"></i>' : '';
                card.innerHTML = `
            <div class="image-container">
                ${pinIcon}
                <img src="${pack.imageUrl}" alt="${pack.title} preview" class="item-image">
            </div>
            <div class="item-content">
                <h3 class="item-title">${pack.title}</h3>
                <p class="item-author">by ${pack.author}</p>
                <div class="item-description-wrapper">
                    <p class="item-description">${pack.description}</p>
                    <button class="read-more-btn">Read More</button>
                </div>
                <div class="item-footer">
                    <div class="button-group">
                        <button class="share-btn" data-pack-id="${pack.id}">
                            <i class="fas fa-share"></i>
                        </button>
                        <a href="${pack.downloadUrl}" class="download-btn" target="_blank" rel="noopener noreferrer">
                            <i class="fas fa-download"></i> Download
                        </a>
                    </div>
                </div>
            </div>
        `;
                textureGrid.appendChild(card);
                const description = card.querySelector('.item-description');
                const readMoreBtn = card.querySelector('.read-more-btn');
                if (description && description.scrollHeight > description.clientHeight) {
                    if (readMoreBtn) {
                        readMoreBtn.style.display = 'block';
                        readMoreBtn.addEventListener('click', () => {
                            description.classList.toggle('expanded');
                            if (description.classList.contains('expanded')) {
                                readMoreBtn.textContent = 'Show Less';
                            } else {
                                readMoreBtn.textContent = 'Read More';
                            }
                        });
                    }
                }
                const shareBtn = card.querySelector('.share-btn');
                if (shareBtn) {
                    shareBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        showSharePopup(pack);
                    });
                }
            });
        }
        function renderCreations() {
            if (!creationGrid) return;
            const sortValue = creationSort ? creationSort.value : 'pinned-alpha';
            let sortedCreations = [...allSubmissions];
            switch (sortValue) {
                case 'alpha':
                    sortedCreations.sort((a, b) => a.title.localeCompare(b.title));
                    break;
                case 'newest':
                    sortedCreations.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                    break;
                case 'pinned-alpha':
                default:
                    sortedCreations.sort((a, b) => {
                        return new Date(b.created_at) - new Date(a.created_at);
                    });
                    break;
            }
            if (sortedCreations.length === 0) {
                creationGrid.innerHTML = `
            <div class="grid-message">
                <i class="fas fa-code"></i>
                <h3>No JavaScript creations yet</h3>
                <p>Be the first to share your JavaScript creation!</p>
                <button id="createFirstBtn" class="submit-btn" style="margin-top: 20px;">
                    <i class="fas fa-plus"></i> Create Your First Creation
                </button>
            </div>`;
                const createFirstBtn = document.getElementById('createFirstBtn');
                if (createFirstBtn) {
                    createFirstBtn.addEventListener('click', () => {
                        if (createBtn) createBtn.click();
                    });
                }
                return;
            }
            creationGrid.innerHTML = '';
            sortedCreations.forEach((creation, index) => {
                const card = document.createElement('div');
                card.className = 'item-card';
                card.style.animationDelay = `${index * 0.05}s`;
                card.dataset.id = creation.id;
                card.innerHTML = `
            <div class="image-container">
                <div class="item-image" style="display: flex; justify-content: center; align-items: center; background: #1a1919;">
                    ${creation.preset_icon ? `<i class="${creation.preset_icon}" style="font-size: 80px; color: #f78c5a;"></i>` : '<i class="fas fa-icons" style="font-size: 80px; color: #888;"></i>'}
                </div>
            </div>
            <div class="item-content">
                <h3 class="item-title">${creation.title}</h3>
                <p class="item-author">by ${creation.username}</p>
                <div class="item-description-wrapper">
                    <p class="item-description">JavaScript Creation</p>
                </div>  
                <div class="item-footer">
                    <button class="download-btn" style="width: 100%;">
                        <i class="fas fa-eye"></i> View Details
                    </button>
                </div>
            </div>
        `;
                card.addEventListener('click', (e) => {
                    if (!e.target.closest('.download-btn')) {
                        showSubmissionDetails(creation.id);
                    }
                });
                
                // Add specific handler for the download button
                const downloadBtn = card.querySelector('.download-btn');
                if (downloadBtn) {
                    downloadBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        showSubmissionDetails(creation.id);
                    });
                }
                creationGrid.appendChild(card);
            });
        }
        function handleSearch(event) {
            const searchTerm = event.target.value.toLowerCase().trim();
            const filteredTpacks = allTpacks.filter(pack =>
                pack.title.toLowerCase().includes(searchTerm) ||
                pack.author.toLowerCase().includes(searchTerm) ||
                pack.description.toLowerCase().includes(searchTerm)
            );
            const filteredCreations = allSubmissions.filter(creation => {
                if (creation.title.toLowerCase().includes(searchTerm) ||
                    creation.username.toLowerCase().includes(searchTerm)) {
                    return true;
                }
                try {
                    const scripts = JSON.parse(creation.scripts);
                    return scripts.some(script =>
                        script.name.toLowerCase().includes(searchTerm) ||
                        script.code.toLowerCase().includes(searchTerm)
                    );
                } catch (e) {
                    // Handle case where creation doesn't have scripts or script property
                    return false;
                }
            });
            if (textureCount) textureCount.textContent = `(${filteredTpacks.length})`;
            if (creationCount) creationCount.textContent = `(${filteredCreations.length})`;
            renderFilteredTexturePacks(filteredTpacks);
            renderFilteredCreations(filteredCreations);
        }
        function renderFilteredTexturePacks(packs) {
            if (!textureGrid) return;
            if (packs.length === 0) {
                textureGrid.innerHTML = `
            <div class="grid-message">
                <i class="fas fa-search"></i>
                <h3>No texture packs found</h3>
                <p>Try different search terms.</p>
            </div>`;
                return;
            }
            textureGrid.innerHTML = '';
            packs.forEach((pack, index) => {
                const card = document.createElement('div');
                card.className = 'item-card';
                card.style.animationDelay = `${index * 0.05}s`;
                card.innerHTML = `
            <div class="image-container">
                <img src="${pack.imageUrl}" alt="${pack.title} preview" class="item-image">
            </div>
            <div class="item-content">
                <h3 class="item-title">${pack.title}</h3>
                <p class="item-author">by ${pack.author}</p>
                <div class="item-description-wrapper">
                    <p class="item-description">${pack.description}</p>
                    <button class="read-more-btn">Read More</button>
                </div>
                <div class="item-footer">
                    <div class="button-group">
                        <button class="share-btn" data-pack-id="${pack.id}">
                            <i class="fas fa-share"></i>
                        </button>
                        <a href="${pack.downloadUrl}" class="download-btn" target="_blank" rel="noopener noreferrer">
                            <i class="fas fa-download"></i> Download
                        </a>
                    </div>
                </div>
            </div>
        `;
                textureGrid.appendChild(card);
                const description = card.querySelector('.item-description');
                const readMoreBtn = card.querySelector('.read-more-btn');
                if (description && description.scrollHeight > description.clientHeight) {
                    if (readMoreBtn) {
                        readMoreBtn.style.display = 'block';
                        readMoreBtn.addEventListener('click', () => {
                            description.classList.toggle('expanded');
                            if (description.classList.contains('expanded')) {
                                readMoreBtn.textContent = 'Show Less';
                            } else {
                                readMoreBtn.textContent = 'Read More';
                            }
                        });
                    }
                }
                const shareBtn = card.querySelector('.share-btn');
                if (shareBtn) {
                    shareBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        showSharePopup(pack);
                    });
                }
            });
        }
        function renderFilteredCreations(creations) {
            if (!creationGrid) return;
            if (creations.length === 0) {
                creationGrid.innerHTML = `
            <div class="grid-message">
                <i class="fas fa-search"></i>
                <h3>No JavaScript creations found</h3>
                <p>Try different search terms.</p>
            </div>`;
                return;
            }
            creationGrid.innerHTML = '';
            creations.forEach((creation, index) => {
                const card = document.createElement('div');
                card.className = 'item-card';
                card.style.animationDelay = `${index * 0.05}s`;
                card.dataset.id = creation.id;
                const isFollowed = followedCreators.has(creation.username);
                const followButton = isFollowed ?
                    `<button class="follow-btn followed" data-creator="${creation.username}" style="position: absolute; top: 10px; right: 10px; z-index: 10; background: #ff6b39; color: white; border: none; border-radius: 12px; padding: 5px 10px; font-size: 0.8rem; cursor: pointer;">
                        <i class="fas fa-user-check"></i> Following
                    </button>` :
                    `<button class="follow-btn" data-creator="${creation.username}" style="position: absolute; top: 10px; right: 10px; z-index: 10; background: rgba(255, 255, 255, 0.2); color: white; border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 12px; padding: 5px 10px; font-size: 0.8rem; cursor: pointer;">
                        <i class="fas fa-user-plus"></i> Follow
                    </button>`;
                const forYouBadge = isFollowed ?
                    `<div style="position: absolute; top: 10px; left: 10px; z-index: 10; background: #ff6b39; color: white; border-radius: 12px; padding: 5px 10px; font-size: 0.8rem; font-weight: bold;">
                        <i class="fas fa-star"></i> For you
                    </div>` : '';
                card.innerHTML = `
            <div class="image-container">
                ${followButton}
                ${forYouBadge}
                <div class="item-image" style="display: flex; justify-content: center; align-items: center; background: #1a1919;">
                    ${creation.preset_icon ? `<i class="${creation.preset_icon}" style="font-size: 80px; color: #f78c5a;"></i>` : '<i class="fas fa-icons" style="font-size: 80px; color: #888;"></i>'}
                </div>
            </div>
            <div class="item-content">
                <h3 class="item-title">${creation.title}</h3>
                <p class="item-author">by ${creation.username}</p>
                <div class="item-description-wrapper">
                    <p class="item-description">JavaScript Creation</p>
                </div>  
                <div class="item-footer">
                    <button class="download-btn" style="width: 100%;">
                        <i class="fas fa-eye"></i> View Details
                    </button>
                </div>
            </div>
        `;
                card.addEventListener('click', (e) => {
                    if (!e.target.closest('.download-btn') && !e.target.closest('.follow-btn')) {
                        showSubmissionDetails(creation.id);
                    }
                });
                
                // Add specific handler for the download button
                const downloadBtn = card.querySelector('.download-btn');
                if (downloadBtn) {
                    downloadBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        showSubmissionDetails(creation.id);
                    });
                }
                
                setTimeout(() => {
                    const followBtn = card.querySelector('.follow-btn');
                    if (followBtn) {
                        followBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            toggleFollow(creation.username, followBtn);
                        });
                    }
                }, 0);
                creationGrid.appendChild(card);
            });
        }
        function showSubmissionDetails(submissionId) {
            const submission = allSubmissions.find(s => s.id == submissionId);
            if (!submission) return;
            if (detailsTitle) detailsTitle.textContent = '';
            if (detailsContent) {
                let scripts = [];
                try {
                    scripts = JSON.parse(submission.scripts);
                } catch (e) {
                    console.error('Error parsing scripts:', e);
                    scripts = [{ name: 'Script', code: submission.script || 'No code available' }];
                }
                let scriptsHtml = '';
                scripts.forEach((script, index) => {
                    scriptsHtml += `
                        <div style="margin-bottom: 25px; border: 1px solid var(--border-color); border-radius: var(--radius-md); overflow: hidden;">
                            <div style="background: var(--surface-color); padding: 12px 16px; border-bottom: 1px solid var(--border-color); font-weight: 600; color: var(--text-accent);">
                                <i class="fas fa-file-code"></i> ${escapeHtml(script.name)}
                            </div>
                            <div style="padding: 16px;">
                                <pre style="background: var(--background-darker); padding: 16px; border-radius: var(--radius-md); font-family: monospace; font-size: 0.9rem; max-height: 300px; overflow-y: auto; white-space: pre-wrap; margin: 0;">${escapeHtml(script.code)}</pre>
                            </div>
                        </div>
                    `;
                });
                detailsContent.innerHTML = `
                    <div class="details-content" style="display: flex; flex-direction: column; height: 100%;">
                        <div class="details-main" style="display: flex; gap: 25px; flex: 1; min-height: 0;">
                            <div class="details-info" style="flex: 1; display: flex; flex-direction: column; gap: 20px; min-width: 250px; max-width: 300px; padding: 10px;">
                                <div class="details-icon" style="display: flex; justify-content: center; align-items: center; height: 180px; background: var(--background-darker); border-radius: var(--radius-lg); border: 1px solid var(--border-color); box-shadow: var(--shadow-md);">
                                    ${submission.preset_icon ? displayIcon(submission.preset_icon) : '<i class="fas fa-icons" style="font-size: 80px; color: #888;"></i>'}
                                </div>
                                <div style="display: flex; flex-direction: column; gap: 15px;">
                                    <h2 style="font-size: 1.5rem; font-weight: 700; color: var(--text-accent); margin: 0; line-height: 1.3;">${escapeHtml(submission.title)}</h2>
                                    <div style="display: flex; flex-direction: column; gap: 8px; padding: 12px; background: var(--surface-color); border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                                        <div style="display: flex; justify-content: space-between; font-size: 0.95rem;">
                                            <span><strong>By:</strong> ${escapeHtml(submission.username)}</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--text-muted);">
                                            <span><i class="fas fa-calendar-alt"></i> ${new Date(submission.created_at).toLocaleDateString()}</span>
                                        </div>
                                    </div>
                                    <button id="copyAllScriptsBtn" class="submit-btn" style="margin-top: 5px; padding: 12px; font-size: 1rem;">
                                        <i class="fas fa-copy"></i> Copy All Scripts
                                    </button>
                                </div>
                            </div>
                            <div class="details-script" style="flex: 2; display: flex; flex-direction: column; gap: 20px; padding: 10px; border-left: 1px solid var(--border-color);">
                                <div style="display: flex; align-items: center; gap: 10px; padding-bottom: 10px; border-bottom: 1px solid var(--border-color);">
                                    <i class="fas fa-file-code" style="font-size: 1.4rem; color: var(--text-accent);"></i>
                                    <h3 style="font-size: 1.4rem; font-weight: 600; color: var(--text-accent); margin: 0;">Scripts</h3>
                                </div>
                                <div style="overflow-y: auto; flex: 1; padding-right: 10px;">
                                    ${scriptsHtml}
                                </div>
                            </div>
                        </div>
                        ${submission.description ? `<div style="margin: 25px 0 5px 0; padding: 20px; background: var(--surface-color); border-radius: var(--radius-md); border: 1px solid var(--border-color); flex-shrink: 0;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
                                <i class="fas fa-align-left" style="font-size: 1.3rem; color: var(--text-accent);"></i>
                                <h3 style="margin: 0; color: var(--text-accent); font-size: 1.4rem;">Description</h3>
                            </div>
                            <p style="margin-bottom: 0; line-height: 1.8; font-size: 1.05rem;">${escapeHtml(submission.description)}</p>
                        </div>` : ''}
                    </div>
                `;
            }
            if (detailsModal) detailsModal.style.display = 'block';
            // Handle the copy functionality for the new button
            setTimeout(() => {
                const copyAllBtn = document.getElementById('copyAllScriptsBtn');
                if (copyAllBtn) {
                    copyAllBtn.onclick = () => {
                        let scripts = [];
                        try {
                            scripts = JSON.parse(submission.scripts);
                        } catch (e) {
                            console.error('Error parsing scripts:', e);
                            scripts = [{ name: 'Script', code: submission.script || '' }];
                        }
                        const allCode = scripts.map(s => `// ${s.name}\n${s.code}`).join('\n\n');
                        navigator.clipboard.writeText(allCode).then(() => {
                            const originalText = copyAllBtn.innerHTML;
                            copyAllBtn.innerHTML = '<i class="fas fa-check"></i> Copied All Scripts!';
                            setTimeout(() => {
                                copyAllBtn.innerHTML = originalText;
                            }, 2000);
                        }).catch(err => {
                            console.error('Failed to copy script: ', err);
                            alert('Failed to copy script to clipboard');
                        });
                    };
                }

                // Keep the original copy button functionality for individual scripts
                if (copyScriptBtn) {
                    copyScriptBtn.onclick = () => {
                        let scripts = [];
                        try {
                            scripts = JSON.parse(submission.scripts);
                        } catch (e) {
                            console.error('Error parsing scripts:', e);
                            scripts = [{ name: 'Script', code: submission.script || '' }];
                        }
                        const allCode = scripts.map(s => `// ${s.name}\n${s.code}`).join('\n\n');
                        navigator.clipboard.writeText(allCode).then(() => {
                            const originalText = copyScriptBtn.innerHTML;
                            copyScriptBtn.innerHTML = '<i class="fas fa-check"></i> Copied All Scripts!';
                            setTimeout(() => {
                                copyScriptBtn.innerHTML = originalText;
                            }, 2000);
                        }).catch(err => {
                            console.error('Failed to copy script: ', err);
                            alert('Failed to copy script to clipboard');
                        });
                    };
                }
            }, 100);
        }
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"]/g, m => map[m]);
        }
        function displayIcon(iconClass) {
            return `<i class="${iconClass}" style="font-size: 150px; color: #f78c5a;"></i>`;
        }
        
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                transform: translateX(120%);
                transition: transform 0.3s ease;
                background: ${type === 'error' ? '#ef4444' : type === 'success' ? '#10b981' : '#3b82f6'};
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                notification.style.transform = 'translateX(120%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        function showSharePopup(pack) {
            if (sharePackImage) sharePackImage.src = pack.imageUrl;
            if (sharePackImage) sharePackImage.alt = `${pack.title} preview`;
            if (sharePackTitle) sharePackTitle.textContent = pack.title;
            if (sharePackAuthor) sharePackAuthor.textContent = `by ${pack.author}`;
            if (sharePackDescription) sharePackDescription.textContent = pack.description;
            const baseUrl = window.location.origin + window.location.pathname;
            const shareUrl = `${baseUrl}?packname=${encodeURIComponent(pack.id)}`;
            if (shareUrlInput) shareUrlInput.value = shareUrl;
            if (shareDownloadBtn) shareDownloadBtn.href = pack.downloadUrl;
            if (sharePopup) sharePopup.style.display = 'flex';
        }
        function checkForSharedPack() {
            const urlParams = new URLSearchParams(window.location.search);
            const packName = urlParams.get('packname');
            if (packName) {
                const pack = allTpacks.find(p => p.id === packName);
                if (pack) {
                    showSharePopup(pack);
                }
            }
        }
        checkForSharedPack();
        document.addEventListener('DOMContentLoaded', function () {
            const statItems = document.querySelectorAll('.stat-item');
            statItems.forEach((item, index) => {
                setTimeout(() => {
                    item.classList.add('animate-in');
                }, 200 * index);
            });
        });
    </script>
</body>

</html>